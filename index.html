<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CMS - NID DATABASE পার্টনার পোর্টাল</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: Arial, Helvetica, sans-serif; background: #f4f6f9; min-height: 100vh; }
    .header { background: #0b5ed7; color: white; padding: 15px; text-align: center; font-size: 20px; font-weight: bold; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; }
    .logo { width: 50px; margin-right: 10px; }
    .container { display: flex; flex-direction: row; min-height: calc(100vh - 60px); }
    .sidebar { width: 220px; background: #fff; border-right: 1px solid #ddd; }
    .sidebar ul { list-style: none; }
    .sidebar ul li a { display: block; padding: 12px; text-decoration: none; color: #000; cursor: pointer; }
    .sidebar ul li a:hover { background: #f0f0f0; }
    .content { flex: 1; padding: 20px; }
    .box { background: #fff; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
    .form-control { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; }
    .btn { padding: 10px 20px; background: #0b5ed7; border: none; color: white; cursor: pointer; border-radius: 5px; font-size: 16px; }
    .btn:hover { background: #0949a5; }

    /* লগইন + OTP */
    #loginContainer, #otpContainer { display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
    #loginForm, #otpForm, #registerForm { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.15); width: 100%; max-width: 400px; text-align: center; }
    #message, #otpMessage, #regMessage { margin-top: 15px; font-weight: bold; }
    .success { color: green; }
    .error { color: red; }
    #dashboard { display: none; }
    #loading { display: none; text-align: center; font-size: 18px; margin: 30px; color: #0b5ed7; }
    .back-btn { margin-bottom: 15px; width: auto; }

    /* Result + PDF viewer */
    #resultArea { margin-top: 15px; display: none; }
    #resultText { margin-bottom: 10px; line-height: 1.6; }
    .viewer { border: 1px solid #ddd; border-radius: 8px; overflow: hidden; height: 420px; background: #fff; }
    .viewer iframe { width: 100%; height: 100%; border: 0; }
    .btnrow { margin-top: 12px; display: flex; gap: 10px; flex-wrap: wrap; }

    /* মোবাইল রেসপনসিভ */
    @media (max-width: 768px) {
      .container { flex-direction: column; }
      .sidebar { width: 100%; border-right: none; border-bottom: 1px solid #ddd; }
      .header { font-size: 18px; padding: 12px; flex-direction: column; gap: 10px; }
      .logo { width: 40px; }
      .form-control, .btn { font-size: 16px; padding: 12px; }
      #loginForm, #otpForm, #registerForm { padding: 25px 15px; max-width: 90%; }
      .viewer { height: 360px; }
    }
  </style>
</head>
<body>

  <!-- লগইন / রেজিস্টার -->
  <div id="loginContainer">
    <div>
      <form id="loginForm">
        <img class="logo" src="https://upload.wikimedia.org/wikipedia/commons/9/9a/Election_Commission_Logo.svg" alt="লোগো">
        <h3>CMS - NID DATABASE পার্টনার পোর্টাল</h3>
        <input type="text" id="userid" class="form-control" placeholder="ইউজার আইডি" required>
        <input type="password" id="password" class="form-control" placeholder="পাসওয়ার্ড" required>
        <button type="submit" class="btn">লগইন</button>
        <p style="margin-top:15px;">অ্যাকাউন্ট নেই? <a href="#" id="showRegister">রেজিস্টার করুন</a></p>
        <div id="message"></div>
      </form>

      <!-- রেজিস্টার ফর্ম (হাইডেন) -->
      <form id="registerForm" style="display:none;">
        <img class="logo" src="https://upload.wikimedia.org/wikipedia/commons/9/9a/Election_Commission_Logo.svg" alt="লোগো">
        <h3>রেজিস্ট্রেশন</h3>
        <input type="text" id="regUserid" class="form-control" placeholder="ইউজার আইডি" required>
        <input type="password" id="regPassword" class="form-control" placeholder="পাসওয়ার্ড" required>
        <button type="submit" class="btn">রেজিস্টার</button>
        <p style="margin-top:15px;"><a href="#" id="showLogin">লগইন পেজে ফিরুন</a></p>
        <div id="regMessage"></div>
      </form>
    </div>
  </div>

  <!-- OTP -->
  <div id="otpContainer" style="display:none;">
    <form id="otpForm">
      <h3>OTP যাচাই</h3>
      <input type="text" id="otp" class="form-control" placeholder="OTP দিন" maxlength="6" inputmode="numeric" autocomplete="one-time-code" required>
      <button type="submit" class="btn">সাবমিট</button>
      <div id="otpMessage"></div>
    </form>
  </div>

  <div id="loading">যাচাই হচ্ছে... অনুগ্রহ করে অপেক্ষা করুন</div>

  <!-- ড্যাশবোর্ড -->
  <div id="dashboard">
    <div class="header">
      <div style="display: flex; align-items: center;">
        <img class="logo" src="https://upload.wikimedia.org/wikipedia/commons/9/9a/Election_Commission_Logo.svg" alt="লোগো">
        <span>CMS - NID DATABASE পার্টনার পোর্টাল</span>
      </div>
      <button class="btn" onclick="logout()">লগআউট</button>
    </div>

    <div class="container">
      <div class="sidebar">
        <ul>
          <li><a onclick="showForm('nid')">এনআইডি সার্চ</a></li>
          <li><a onclick="showForm('mobile')">মোবাইল সার্চ</a></li>
          <li><a onclick="showForm('birth')">জন্ম নিবন্ধন সার্চ</a></li>
          <li><a onclick="showForm('formno')">ফর্ম নাম্বার</a></li>
          <li><a onclick="showForm('correction')">সংশোধন অনুমোদন</a></li>
        </ul>
      </div>
      <div class="content">
        <div class="box" id="formArea">
          <h3>একটি অপশন নির্বাচন করুন</h3>
        </div>

        <!-- Result + PDF Viewer -->
        <div class="box" id="resultArea">
          <h3 style="margin-bottom:10px;">রেজাল্ট</h3>
          <div id="resultText"></div>

          <div class="viewer">
            <iframe id="pdfViewer"></iframe>
          </div>

          <div class="btnrow">
            <button class="btn" id="downloadBtn" style="display:none;">PDF ডাউনলোড</button>
            <button class="btn" onclick="clearResult()">ক্লিয়ার</button>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const { jsPDF } = window.jspdf;

    // OTP লিস্ট (আপনার আগের মতোই রাখা হলো)
    const validOTPs = ["400087", "116643", "698908", "226350"];

    // রেজিস্ট্রেশন / লগইন টগল
    document.getElementById("showRegister").addEventListener("click", e => {
      e.preventDefault();
      document.getElementById("loginForm").style.display = "none";
      document.getElementById("registerForm").style.display = "block";
    });
    document.getElementById("showLogin").addEventListener("click", e => {
      e.preventDefault();
      document.getElementById("registerForm").style.display = "none";
      document.getElementById("loginForm").style.display = "block";
    });

    // রেজিস্টার
    document.getElementById("registerForm").addEventListener("submit", e => {
      e.preventDefault();
      const user = document.getElementById("regUserid").value.trim();
      const pass = document.getElementById("regPassword").value.trim();
      const regMsg = document.getElementById("regMessage");

      if (!user || !pass) {
        regMsg.textContent = "সব ফিল্ড পূরণ করুন।"; regMsg.className = "error"; return;
      }

      const existing = localStorage.getItem("ecUser");
      if (existing) {
        regMsg.textContent = "শুধু একটি অ্যাকাউন্ট রেজিস্টার করা যাবে। লগইন করুন।"; regMsg.className = "error";
        return;
      }

      localStorage.setItem("ecUser", JSON.stringify({ userid: user, password: pass }));
      regMsg.textContent = "রেজিস্ট্রেশন সফল! এখন লগইন করুন।"; regMsg.className = "success";
      setTimeout(() => {
        document.getElementById("registerForm").style.display = "none";
        document.getElementById("loginForm").style.display = "block";
      }, 2000);
    });

    // লগইন
    document.getElementById("loginForm").addEventListener("submit", e => {
      e.preventDefault();
      const user = document.getElementById("userid").value.trim();
      const pass = document.getElementById("password").value.trim();
      const message = document.getElementById("message");

      const stored = JSON.parse(localStorage.getItem("ecUser"));
      if (!stored || stored.userid !== user || stored.password !== pass) {
        message.textContent = "ভুল ইউজার আইডি বা পাসওয়ার্ড!"; message.className = "error";
        return;
      }

      message.textContent = "যাচাই হচ্ছে..."; message.className = "success";
      document.getElementById("loading").style.display = "block";
      setTimeout(() => {
        document.getElementById("loginContainer").style.display = "none";
        document.getElementById("loading").style.display = "none";
        document.getElementById("otpContainer").style.display = "flex";
      }, 900);
    });

    // OTP
    document.getElementById("otpForm").addEventListener("submit", e => {
      e.preventDefault();
      const otp = document.getElementById("otp").value.trim();
      const msg = document.getElementById("otpMessage");

      if (validOTPs.includes(otp)) {
        msg.textContent = "সফল! স্বাগতম।"; msg.className = "success";
        setTimeout(() => {
          document.getElementById("otpContainer").style.display = "none";
          document.getElementById("dashboard").style.display = "block";
        }, 600);
      } else {
        msg.textContent = "ভুল OTP!"; msg.className = "error";
      }
    });

    function logout() { location.reload(); }

    // ===== Result + PDF Viewer (Blank PDF) =====
    let lastPdfBlobUrl = null;

    function clearResult() {
      document.getElementById("resultArea").style.display = "none";
      document.getElementById("resultText").innerHTML = "";
      document.getElementById("pdfViewer").src = "";
      document.getElementById("downloadBtn").style.display = "none";

      if (lastPdfBlobUrl) {
        URL.revokeObjectURL(lastPdfBlobUrl);
        lastPdfBlobUrl = null;
      }
    }

    function backToDefault() {
      document.getElementById("formArea").innerHTML = "<h3>একটি অপশন নির্বাচন করুন</h3>";
      clearResult();
    }

    function showForm(type) {
      clearResult();

      let title = "";
      if (type === "nid") title = "এনআইডি সার্চ";
      if (type === "mobile") title = "মোবাইল সার্চ";
      if (type === "birth") title = "জন্ম নিবন্ধন সার্চ";
      if (type === "formno") title = "ফর্ম নাম্বার";
      if (type === "correction") title = "সংশোধন অনুমোদন";

      let html = `<button class="btn back-btn" onclick="backToDefault()">back</button><h3>${title}</h3>`;

      if (type === "nid") {
        html += `
          <input type="text" id="nidInput" class="form-control" placeholder="এনআইডি নাম্বার">
          <select id="nidType" class="form-control">
            <option value="ServerCopy">সার্ভার কপি</option>
            <option value="SignCopy">সাইন কপি</option>
          </select>
          <button class="btn" onclick="search('nid')">সার্চ</button>
        `;
      } else if (type === "mobile") {
        html += `
          <input type="text" id="mobileInput" class="form-control" placeholder="মোবাইল নাম্বার (যেমন: 01XXXXXXXXX)">
          <button class="btn" onclick="search('mobile')">সার্চ</button>
        `;
      } else if (type === "birth") {
        html += `
          <input type="text" id="birthInput" class="form-control" placeholder="জন্ম নিবন্ধন নাম্বার">
          <button class="btn" onclick="search('birth')">সার্চ</button>
        `;
      } else if (type === "formno") {
        html += `
          <input type="text" id="formnoInput" class="form-control" placeholder="ফর্ম নাম্বার">
          <button class="btn" onclick="search('formno')">সার্চ</button>
        `;
      } else if (type === "correction") {
        html += `
          <input type="text" id="correctionInput" class="form-control" placeholder="সংশোধন রেফারেন্স/আইডি">
          <button class="btn" onclick="search('correction')">সার্চ</button>
        `;
      }

      document.getElementById("formArea").innerHTML = html;
    }

    function search(type) {
      let inputVal = "";
      let filename = "";

      if (type === "nid") {
        inputVal = document.getElementById("nidInput").value.trim();
        const nidType = document.getElementById("nidType").value; // ServerCopy / SignCopy
        filename = `NID_${nidType}_${(inputVal || "UNKNOWN")}.pdf`;
      } else if (type === "mobile") {
        inputVal = document.getElementById("mobileInput").value.trim();
        filename = `Mobile_${(inputVal || "UNKNOWN")}.pdf`;
      } else if (type === "birth") {
        inputVal = document.getElementById("birthInput").value.trim();
        filename = `Birth_${(inputVal || "UNKNOWN")}.pdf`;
      } else if (type === "formno") {
        inputVal = document.getElementById("formnoInput").value.trim();
        filename = `FormNo_${(inputVal || "UNKNOWN")}.pdf`;
      } else if (type === "correction") {
        inputVal = document.getElementById("correctionInput").value.trim();
        filename = `Correction_${(inputVal || "UNKNOWN")}.pdf`;
      } else {
        inputVal = "N/A";
        filename = `${type.toUpperCase()}_BLANK.pdf`;
      }

      // আগের blob url থাকলে ক্লিন
      if (lastPdfBlobUrl) {
        URL.revokeObjectURL(lastPdfBlobUrl);
        lastPdfBlobUrl = null;
      }

      // ✅ BLANK WHITE PDF (কোনো লেখা নেই)
      const doc = new jsPDF();
      // intentionally blank: no doc.text()

      const pdfBlob = doc.output("blob");
      lastPdfBlobUrl = URL.createObjectURL(pdfBlob);

      // ✅ Result area show
      document.getElementById("resultArea").style.display = "block";
      document.getElementById("resultText").innerHTML =
        `<b>অপশন:</b> ${type.toUpperCase()}<br><b>সার্চ ভ্যালু:</b> ${inputVal || "(ফাঁকা)"}`;

      // ✅ Viewer-এ শো
      document.getElementById("pdfViewer").src = lastPdfBlobUrl;

      // ✅ Download
      const downloadBtn = document.getElementById("downloadBtn");
      downloadBtn.style.display = "inline-block";
      downloadBtn.onclick = () => {
        const a = document.createElement("a");
        a.href = lastPdfBlobUrl;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        a.remove();
      };
    }
  </script>
</body>
</html>
